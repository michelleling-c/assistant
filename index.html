<!DOCTYPE html>
<html lang="zh-Hant-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºå‹ä¼´ - è€å‹è¨˜åŠ©æ‰‹</title>
    <style>
        :root {
            --primary-yellow: #facc15;
            --light-yellow: #fef9c3;
            --btn-hover: #eab308;
            --bg-color: #cfd1bb;
            --card-bg: var(--light-yellow);
            --border-black: #000000;
        }

        body {
            background-color: var(--bg-color);
            color: #000000;
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background-color: var(--primary-yellow);
            border-bottom: 3px solid var(--border-black);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-main { display: flex; align-items: center; gap: 8px; }
        .heart-icon { color: #cc3333; width: 28px; height: 28px; }
        h1 { margin: 0; font-size: 1.6rem; font-weight: 900; }
        
        .test-voice-btn {
            background: #fff;
            border: 2px solid #000;
            padding: 8px 15px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 2px 2px 0 #000;
        }

        .info-container {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            max-width: 700px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .info-row { display: flex; gap: 15px; width: 100%; }
        
        .info-box {
            background: var(--card-bg);
            border: 3px solid var(--border-black);
            border-radius: 25px;
            padding: 20px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 4px 6px 0px rgba(0,0,0,0.3);
        }

        .info-label { font-size: 1.1rem; color: #333; font-weight: bold; margin-bottom: 4px; }
        .info-value { font-size: 2.2rem; font-weight: 900; }
        .icon-large { font-size: 2.5rem; }

        #chat-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
        }

        .message {
            width: 90%;
            margin: 10px auto;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid var(--border-black);
            border-radius: 20px;
            background-color: #ffffff;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        footer {
            padding: 10px 20px 40px 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .big-btn {
            background-color: var(--primary-yellow);
            border: 3px solid var(--border-black);
            border-radius: 20px;
            padding: 18px;
            font-size: 1.6rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            box-shadow: 0 6px 0 var(--border-black);
        }

        .big-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 var(--border-black); }
        #loading { text-align: center; color: #8b5cf6; font-weight: bold; display: none; margin-bottom: 5px; }
    </style>
</head>
<body>

<header>
    <div class="header-main">
        <svg class="heart-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        <h1>è€å‹è¨˜æ™ºèƒ½åŠ©æ‰‹</h1>
    </div>
    <button class="test-voice-btn" onclick="testVoice()">ğŸ”Š è©¦è²</button>
</header>

<div class="info-container">
    <div class="info-row">
        <div class="info-box">
            <span class="icon-large">ğŸ•’</span>
            <div>
                <div class="info-label">æ™‚é–“</div>
                <div id="info-time" class="info-value">--:--</div>
            </div>
        </div>
        <div class="info-box">
            <span class="icon-large">ğŸ“…</span>
            <div>
                <div class="info-label">æ—¥æœŸ</div>
                <div id="info-date" class="info-value">--/--</div>
            </div>
        </div>
    </div>
</div>

<div id="chat-area">
    <div id="loading">âœ¨ æ™ºå‹ä¼´é€£ç·Šå¤©æ–‡å°...</div>
    <div id="chat-bubble" class="message">
        è€å‹è¨˜ï¼Œæ—©æ™¨ï¼ä»Šæ—¥æƒ³çŸ¥å¹¾è™Ÿå®šä¿‚æƒ³çŸ¥å¤©æ°£ï¼Ÿ
    </div>
</div>

<footer>
    <button class="big-btn" onclick="handleAction('date')">ğŸ—“ï¸ ä»Šæ—¥å¹¾æœˆå¹¾è™Ÿï¼Ÿ</button>
    <button class="big-btn" onclick="handleAction('weather')">â˜€ï¸ ä»Šæ—¥å¤©æ°£é»å‘€ï¼Ÿ</button>
    <button class="big-btn" onclick="handleAction('festival')">ğŸ§§ å°±åšŸå’©ç¯€æ—¥ï¼Ÿ</button>
</footer>

<script>
    const synth = window.speechSynthesis;
    let voices = [];

    function loadVoices() {
        voices = synth.getVoices();
        if (voices.length === 0) setTimeout(loadVoices, 100);
    }
    if ('onvoiceschanged' in synth) synth.onvoiceschanged = loadVoices;
    loadVoices();

    function speak(text) {
        if (!synth) return;
        synth.cancel(); 
        if (text === "") return;
        const utter = new SpeechSynthesisUtterance(text);
        if (voices.length === 0) voices = synth.getVoices();
        const cantoneseVoice = voices.find(v => v.lang === 'zh-HK' || v.lang.includes('yue-HK') || v.lang.includes('HK'));
        if (cantoneseVoice) utter.voice = cantoneseVoice;
        utter.lang = 'zh-HK';
        utter.rate = 0.85;
        utter.pitch = 1.0;
        synth.speak(utter);
    }

    function testVoice() {
        speak("æ¸¬è©¦æˆåŠŸï¼è€å‹è¨˜ï¼Œä½ è€Œå®¶å¯ä»¥è½åˆ°æˆ‘è¬›å˜¢å–‡ã€‚");
        document.getElementById('chat-bubble').innerText = "å¤ªå¥½å–‡ï¼èªéŸ³åŠŸèƒ½å·²ç¶“æº–å‚™å¥½ã€‚";
    }

    function updateClock() {
        const now = new Date();
        document.getElementById('info-time').innerText = now.toLocaleTimeString('zh-HK', { hour: '2-digit', minute: '2-digit', hour12: false });
        document.getElementById('info-date').innerText = `${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥`;
    }

    // å¤©æ–‡å°åœ–ç¤ºä»£ç¢¼å°æ‡‰
    function getWeatherDesc(iconCode) {
        if (iconCode >= 50 && iconCode <= 54) return "æœ‰é›¨";
        if (iconCode >= 60 && iconCode <= 65) return "å¤§é›¨æˆ–é›·æš´";
        if (iconCode >= 70 && iconCode <= 77) return "å¤šé›²";
        if (iconCode >= 80 && iconCode <= 84) return "å¤©æ™´";
        if (iconCode >= 90) return "ä¹¾ç‡¥";
        return "å¤§è‡´å¤šé›²";
    }

    async function fetchHKOWeather() {
        try {
            // 1. ç²å–å³æ™‚å¤©æ°£ (æ°£æº«ã€æ¿•åº¦ã€å¤©æ°£åœ–ç¤º)
            const weatherRes = await fetch('https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=tc');
            const weatherData = await weatherRes.json();
            
            // 2. ç²å–å¤©æ°£è­¦å‘Šæ‘˜è¦
            const warnRes = await fetch('https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=warnsum&lang=tc');
            const warnData = await warnRes.json();

            const temp = weatherData.temperature.data[0].value;
            const humidity = weatherData.humidity.data[0].value;
            const icon = weatherData.icon[0];
            const weatherCondition = getWeatherDesc(icon);

            // è§£æè­¦å‘Šä¿¡è™Ÿ
            let warnings = [];
            for (let key in warnData) {
                warnings.push(warnData[key].name);
            }
            let warningText = warnings.length > 0 ? `è€Œå®¶ç”Ÿæ•ˆç·Šå˜…ä¿¡è™Ÿæœ‰ï¼š${warnings.join('ã€')}ã€‚` : "ç›®å‰å†‡ç‰¹åˆ¥å¤©æ°£ä¿¡è™Ÿç”Ÿæ•ˆã€‚";

            // ç”Ÿæˆé•·è€…é—œæ‡·å»ºè­°
            let advice = "å¤©æ°£å””éŒ¯ã€‚";
            if (temp < 15) advice = "ä»Šæ—¥å¥½å‡å‘€ï¼Œè€å‹è¨˜è¨˜å¾—è‘—å¤šä»¶åšæ£‰è¥–ï¼Œå¸¶å®šé ¸å·¾å‘€ã€‚";
            else if (temp > 28) advice = "å‡ºé¢å¥½ç†±å‘€ï¼Œè€å‹è¨˜è¨˜å¾—å¸¶æ”¯æ°´ï¼Œå””å¥½ä¸­æš‘å‘€ã€‚";
            
            if (humidity > 85) advice += " æ¿•åº¦å¥½é«˜ï¼Œåœ°ä¸‹å¯èƒ½æœƒæ»‘ï¼Œè¡Œè·¯è¦å°å¿ƒå•²ã€‚";
            else if (humidity < 40) advice += " å¤©æ°£å¥½ä¹¾ç‡¥ï¼Œè¨˜å¾—æŸ¥æ½¤è†šè†å‘€ã€‚";
            
            if (weatherCondition.includes("é›¨")) advice += " å‡ºè¡—è¨˜å¾—å¸¶è¿”æŠŠå‚˜å‘€ã€‚";

            return `å ±å‘Šè€å‹è¨˜ï¼šè€Œå®¶æ°£æº« ${temp} åº¦ï¼Œæ¿•åº¦ç™¾åˆ†ä¹‹ ${humidity}ã€‚å¤©æ°£ ${weatherCondition}ã€‚${warningText}${advice}`;
        } catch (e) {
            return "æš«æ™‚å•å””åˆ°å¤©æ–‡å°ï¼Œä¸éç‡å€‹å¤©å¥½ä¼¼å¹¾å¥½ï¼Œè¨˜å¾—è‘—å¤ è¡«å‘€ã€‚";
        }
    }

    async function handleAction(type) {
        speak(""); 
        const bubble = document.getElementById('chat-bubble');
        const loading = document.getElementById('loading');
        
        loading.style.display = 'block';
        bubble.innerText = "...";
        
        let reply = "";
        if (type === 'date') {
            const now = new Date();
            const days = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
            reply = `ä»Šæ—¥ä¿‚ ${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ï¼Œæ˜ŸæœŸ${days[now.getDay()]}ã€‚`;
        } else if (type === 'weather') {
            reply = await fetchHKOWeather();
        } else if (type === 'festival') {
            const now = new Date();
            reply = "å°±å¿«éå¹´å–‡ï¼ç¥ä½ èº«é«”å¥åº·ï¼Œé–‹é–‹å¿ƒå¿ƒã€‚"; // ç°¡åŒ–ç‰ˆ
        }

        loading.style.display = 'none';
        bubble.innerText = reply;
        speak(reply);
    }

    window.onload = () => {
        updateClock();
        setInterval(updateClock, 10000);
        loadVoices();
    };
</script>
</body>
</html>
